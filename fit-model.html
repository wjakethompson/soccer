<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Soccer Predictions Using Bayesian Mixed Effects Models</title>
  <meta name="description" content="A tutorial for creating a ranking system for soccer teams and making predictions.">
  <meta name="generator" content="bookdown 0.3.19 and GitBook 2.6.7">

  <meta property="og:title" content="Soccer Predictions Using Bayesian Mixed Effects Models" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A tutorial for creating a ranking system for soccer teams and making predictions." />
  <meta name="github-repo" content="wjakethompson/soccer" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Soccer Predictions Using Bayesian Mixed Effects Models" />
  <meta name="twitter:site" content="@wjakethompson" />
  <meta name="twitter:description" content="A tutorial for creating a ranking system for soccer teams and making predictions." />
  

<meta name="author" content="Jake Thompson">


<meta name="date" content="2017-05-04">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="gather-data.html">
<link rel="next" href="predict.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.8/htmlwidgets.js"></script>
<script src="libs/datatables-binding-0.2/datatables.js"></script>
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.12/js/jquery.dataTables.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Soccer Predictions</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#european-soccer-format"><i class="fa fa-check"></i><b>1.1</b> European soccer format</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#dom-league-descrip"><i class="fa fa-check"></i><b>1.1.1</b> Domestic leagues</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro.html"><a href="intro.html#domestic-cups"><i class="fa fa-check"></i><b>1.1.2</b> Domestic cups</a></li>
<li class="chapter" data-level="1.1.3" data-path="intro.html"><a href="intro.html#fifa-and-uefa-competitions"><i class="fa fa-check"></i><b>1.1.3</b> FIFA and UEFA Competitions</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#document-organization"><i class="fa fa-check"></i><b>1.2</b> Document organization</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#colophon"><i class="fa fa-check"></i><b>1.3</b> Colophon</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="define-model.html"><a href="define-model.html"><i class="fa fa-check"></i><b>2</b> Defining the Model</a><ul>
<li class="chapter" data-level="2.1" data-path="define-model.html"><a href="define-model.html#biv-pois"><i class="fa fa-check"></i><b>2.1</b> The bivariate Poisson model</a><ul>
<li class="chapter" data-level="2.1.1" data-path="define-model.html"><a href="define-model.html#imp-bivpois"><i class="fa fa-check"></i><b>2.1.1</b> Implementing the bivariate Poisson model</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="define-model.html"><a href="define-model.html#gri"><i class="fa fa-check"></i><b>2.2</b> The game random intercept model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="define-model.html"><a href="define-model.html#imp-gri"><i class="fa fa-check"></i><b>2.2.1</b> Implementing the game random intercept model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>3</b> Simulation Study</a><ul>
<li class="chapter" data-level="3.1" data-path="simulation.html"><a href="simulation.html#data-generation"><i class="fa fa-check"></i><b>3.1</b> Data generation</a></li>
<li class="chapter" data-level="3.2" data-path="simulation.html"><a href="simulation.html#model-est"><i class="fa fa-check"></i><b>3.2</b> Model estimation</a></li>
<li class="chapter" data-level="3.3" data-path="simulation.html"><a href="simulation.html#running-the-simulation"><i class="fa fa-check"></i><b>3.3</b> Running the simulation</a></li>
<li class="chapter" data-level="3.4" data-path="simulation.html"><a href="simulation.html#sim-results"><i class="fa fa-check"></i><b>3.4</b> Simulation results</a><ul>
<li class="chapter" data-level="3.4.1" data-path="simulation.html"><a href="simulation.html#sim-corr"><i class="fa fa-check"></i><b>3.4.1</b> Correlation between true and estimated parameters</a></li>
<li class="chapter" data-level="3.4.2" data-path="simulation.html"><a href="simulation.html#sim-bias-mse"><i class="fa fa-check"></i><b>3.4.2</b> Estimation bias and mean square error</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="simulation.html"><a href="simulation.html#sim-concl"><i class="fa fa-check"></i><b>3.5</b> Summary of findings</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gather-data.html"><a href="gather-data.html"><i class="fa fa-check"></i><b>4</b> Gather Data</a><ul>
<li class="chapter" data-level="4.1" data-path="gather-data.html"><a href="gather-data.html#domestic-league-inclusion"><i class="fa fa-check"></i><b>4.1</b> Domestic league inclusion</a></li>
<li class="chapter" data-level="4.2" data-path="gather-data.html"><a href="gather-data.html#non-domestic-competition-inclusion"><i class="fa fa-check"></i><b>4.2</b> Non-domestic competition inclusion</a></li>
<li class="chapter" data-level="4.3" data-path="gather-data.html"><a href="gather-data.html#domestic-competition-inclusion"><i class="fa fa-check"></i><b>4.3</b> Domestic competition inclusion</a></li>
<li class="chapter" data-level="4.4" data-path="gather-data.html"><a href="gather-data.html#collect-club-websites"><i class="fa fa-check"></i><b>4.4</b> Collect club websites</a></li>
<li class="chapter" data-level="4.5" data-path="gather-data.html"><a href="gather-data.html#scrape-game-data"><i class="fa fa-check"></i><b>4.5</b> Scrape game data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="fit-model.html"><a href="fit-model.html"><i class="fa fa-check"></i><b>5</b> Fitting the Model</a><ul>
<li class="chapter" data-level="5.1" data-path="fit-model.html"><a href="fit-model.html#fit-real-data"><i class="fa fa-check"></i><b>5.1</b> Model estimation</a></li>
<li class="chapter" data-level="5.2" data-path="fit-model.html"><a href="fit-model.html#diagnostics"><i class="fa fa-check"></i><b>5.2</b> MCMC diagnostics</a><ul>
<li class="chapter" data-level="5.2.1" data-path="fit-model.html"><a href="fit-model.html#convergence"><i class="fa fa-check"></i><b>5.2.1</b> Convergence</a></li>
<li class="chapter" data-level="5.2.2" data-path="fit-model.html"><a href="fit-model.html#efficiency"><i class="fa fa-check"></i><b>5.2.2</b> Efficiency</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="fit-model.html"><a href="fit-model.html#model-fit"><i class="fa fa-check"></i><b>5.3</b> Model fit</a><ul>
<li class="chapter" data-level="5.3.1" data-path="fit-model.html"><a href="fit-model.html#ppmc-score-dist"><i class="fa fa-check"></i><b>5.3.1</b> Score distributions</a></li>
<li class="chapter" data-level="5.3.2" data-path="fit-model.html"><a href="fit-model.html#ppmc-mov-int"><i class="fa fa-check"></i><b>5.3.2</b> Margin of victory intervals</a></li>
<li class="chapter" data-level="5.3.3" data-path="fit-model.html"><a href="fit-model.html#ppmc-prediction"><i class="fa fa-check"></i><b>5.3.3</b> Prediction error</a></li>
<li class="chapter" data-level="5.3.4" data-path="fit-model.html"><a href="fit-model.html#posterior-predictive-check-summary"><i class="fa fa-check"></i><b>5.3.4</b> Posterior predictive check summary</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="fit-model.html"><a href="fit-model.html#results"><i class="fa fa-check"></i><b>5.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="predict.html"><a href="predict.html"><i class="fa fa-check"></i><b>6</b> Making Predictions</a><ul>
<li class="chapter" data-level="6.1" data-path="predict.html"><a href="predict.html#predict-individual-games"><i class="fa fa-check"></i><b>6.1</b> Predict individual games</a></li>
<li class="chapter" data-level="6.2" data-path="predict.html"><a href="predict.html#predict-domestic-leagues"><i class="fa fa-check"></i><b>6.2</b> Predict domestic leagues</a><ul>
<li class="chapter" data-level="6.2.1" data-path="predict.html"><a href="predict.html#epl"><i class="fa fa-check"></i><b>6.2.1</b> English Premier League</a></li>
<li class="chapter" data-level="6.2.2" data-path="predict.html"><a href="predict.html#ligue1"><i class="fa fa-check"></i><b>6.2.2</b> French Ligue 1</a></li>
<li class="chapter" data-level="6.2.3" data-path="predict.html"><a href="predict.html#bund"><i class="fa fa-check"></i><b>6.2.3</b> German Bundesliga</a></li>
<li class="chapter" data-level="6.2.4" data-path="predict.html"><a href="predict.html#seriea"><i class="fa fa-check"></i><b>6.2.4</b> Italian Serie A</a></li>
<li class="chapter" data-level="6.2.5" data-path="predict.html"><a href="predict.html#laliga"><i class="fa fa-check"></i><b>6.2.5</b> Spanish La Liga</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="predict.html"><a href="predict.html#uefa-champions-league"><i class="fa fa-check"></i><b>6.3</b> UEFA Champions League</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a><ul>
<li class="chapter" data-level="7.1" data-path="conclusion.html"><a href="conclusion.html#limitations-and-future-directions"><i class="fa fa-check"></i><b>7.1</b> Limitations and future directions</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="simulation-functions.html"><a href="simulation-functions.html"><i class="fa fa-check"></i><b>A</b> Simulation Functions</a><ul>
<li class="chapter" data-level="A.1" data-path="simulation-functions.html"><a href="simulation-functions.html#bivpois-generate"><i class="fa fa-check"></i><b>A.1</b> Generate bivariate Poisson</a></li>
<li class="chapter" data-level="A.2" data-path="simulation-functions.html"><a href="simulation-functions.html#gri-generate"><i class="fa fa-check"></i><b>A.2</b> Generate game random intercept</a></li>
<li class="chapter" data-level="A.3" data-path="simulation-functions.html"><a href="simulation-functions.html#estimate-fun"><i class="fa fa-check"></i><b>A.3</b> Fit models to simualted data</a></li>
<li class="chapter" data-level="A.4" data-path="simulation-functions.html"><a href="simulation-functions.html#ggally-cor"><i class="fa fa-check"></i><b>A.4</b> Plot correlation matrices</a><ul>
<li class="chapter" data-level="A.4.1" data-path="simulation-functions.html"><a href="simulation-functions.html#ggally-comp"><i class="fa fa-check"></i><b>A.4.1</b> Plot components</a></li>
<li class="chapter" data-level="A.4.2" data-path="simulation-functions.html"><a href="simulation-functions.html#ggally-plot"><i class="fa fa-check"></i><b>A.4.2</b> Plot creation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="scrape-functions.html"><a href="scrape-functions.html"><i class="fa fa-check"></i><b>B</b> Web Scraping Functions</a><ul>
<li class="chapter" data-level="B.1" data-path="scrape-functions.html"><a href="scrape-functions.html#league-scrape"><i class="fa fa-check"></i><b>B.1</b> Scrape league pages</a></li>
<li class="chapter" data-level="B.2" data-path="scrape-functions.html"><a href="scrape-functions.html#cup-scrape"><i class="fa fa-check"></i><b>B.2</b> Scrape international cups</a></li>
<li class="chapter" data-level="B.3" data-path="scrape-functions.html"><a href="scrape-functions.html#dom-scrape"><i class="fa fa-check"></i><b>B.3</b> Scrape domestic cups</a></li>
<li class="chapter" data-level="B.4" data-path="scrape-functions.html"><a href="scrape-functions.html#game-scrape"><i class="fa fa-check"></i><b>B.4</b> Scrape games</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="diagnostic-output.html"><a href="diagnostic-output.html"><i class="fa fa-check"></i><b>C</b> Model Diagnostics Output</a><ul>
<li class="chapter" data-level="C.1" data-path="diagnostic-output.html"><a href="diagnostic-output.html#rhat-plot"><i class="fa fa-check"></i><b>C.1</b> Plot <span class="math inline">\(\hat{R}\)</span> values</a></li>
<li class="chapter" data-level="C.2" data-path="diagnostic-output.html"><a href="diagnostic-output.html#plot-effective-sample-size-values"><i class="fa fa-check"></i><b>C.2</b> Plot effective sample size values</a></li>
<li class="chapter" data-level="C.3" data-path="diagnostic-output.html"><a href="diagnostic-output.html#nuts-diagnostics-table"><i class="fa fa-check"></i><b>C.3</b> NUTS diagnostics table</a></li>
<li class="chapter" data-level="C.4" data-path="diagnostic-output.html"><a href="diagnostic-output.html#ppmc-sdp"><i class="fa fa-check"></i><b>C.4</b> PPMC score distribution plot</a></li>
<li class="chapter" data-level="C.5" data-path="diagnostic-output.html"><a href="diagnostic-output.html#ppmc-mov"><i class="fa fa-check"></i><b>C.5</b> PPMC margin of victory credible intervals</a></li>
<li class="chapter" data-level="C.6" data-path="diagnostic-output.html"><a href="diagnostic-output.html#log-loss-comparison-table"><i class="fa fa-check"></i><b>C.6</b> Log loss comparison table</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="prediction-functions.html"><a href="prediction-functions.html"><i class="fa fa-check"></i><b>D</b> Prediction Functions</a><ul>
<li class="chapter" data-level="D.1" data-path="prediction-functions.html"><a href="prediction-functions.html#predict-game"><i class="fa fa-check"></i><b>D.1</b> Predict individual games</a></li>
<li class="chapter" data-level="D.2" data-path="prediction-functions.html"><a href="prediction-functions.html#multi-plot"><i class="fa fa-check"></i><b>D.2</b> Plot multiple plots</a></li>
<li class="chapter" data-level="D.3" data-path="prediction-functions.html"><a href="prediction-functions.html#predict-league"><i class="fa fa-check"></i><b>D.3</b> Predict leagues</a></li>
<li class="chapter" data-level="D.4" data-path="prediction-functions.html"><a href="prediction-functions.html#predict-ucl"><i class="fa fa-check"></i><b>D.4</b> Predict Champions League</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Soccer Predictions Using Bayesian Mixed Effects Models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fit-model" class="section level1">
<h1><span class="header-section-number">5</span> Fitting the Model</h1>
<p>With the data gathered, the next step is to estimate the model to get ability estimates for each team. Following the findings of the simulation study in Section <a href="simulation.html#simulation">3</a>, the game random intercept model will be used for the estimation.</p>
<div id="fit-real-data" class="section level2">
<h2><span class="header-section-number">5.1</span> Model estimation</h2>
<p>The first step is to load in the data set and do some filtering using the <strong>dplyr</strong> package <span class="citation">(Wickham &amp; Francois, 2016)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">load</span>(<span class="st">&quot;_data/full_data.rda&quot;</span>)</code></pre></div>
<p>To filter, I first remove any game that hasn’t been played (or was canceled) by removing any games that don’t have a score for either team. I also remove the competition field, as it is not necessary for the model estimation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit_data &lt;-<span class="st">  </span>full_data %&gt;%
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(h_goals), !<span class="kw">is.na</span>(a_goals)) %&gt;%
<span class="st">  </span><span class="kw">select</span>(-competition)</code></pre></div>
<p>Next, I filter the data to only include teams with a least 5 games played. This is to ensure that all teams included have a sufficient number of games to get reasonable estimates. This process is done iteratively to ensure that after removing teams with less than five games, teams that orginally had more than 5 games, but now no longer meet the criteria are also excluded.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filter_games &lt;-<span class="st"> </span><span class="ot">TRUE</span>
while(filter_games) {
  team_counts &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">c</span>(fit_data$home, fit_data$away)) %&gt;%<span class="st"> </span><span class="kw">as_data_frame</span>() %&gt;%
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) %&gt;%
<span class="st">    </span><span class="kw">filter</span>(n &gt;=<span class="st"> </span><span class="dv">5</span>) %&gt;%
<span class="st">    </span><span class="kw">select</span>(<span class="dt">team =</span> Var1, <span class="dt">games =</span> n) %&gt;%
<span class="st">    </span><span class="kw">arrange</span>(team) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">code =</span> <span class="kw">seq_len</span>(<span class="kw">nrow</span>(.)))
  
  fit_data &lt;-<span class="st"> </span>fit_data %&gt;%
<span class="st">    </span><span class="kw">left_join</span>(<span class="kw">select</span>(team_counts, -games), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;home&quot;</span> =<span class="st"> &quot;team&quot;</span>)) %&gt;%
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">home_code =</span> code) %&gt;%
<span class="st">    </span><span class="kw">left_join</span>(<span class="kw">select</span>(team_counts, -games), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;away&quot;</span> =<span class="st"> &quot;team&quot;</span>)) %&gt;%
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">away_code =</span> code) %&gt;%
<span class="st">    </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(home_code), !<span class="kw">is.na</span>(away_code))
  
  new_min &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">c</span>(fit_data$home, fit_data$away)) %&gt;%<span class="st"> </span><span class="kw">as.numeric</span>() %&gt;%<span class="st"> </span><span class="kw">min</span>()
  if (new_min &gt;=<span class="st"> </span><span class="dv">5</span>) {
    filter_games &lt;-<span class="st"> </span><span class="ot">FALSE</span>
  } else {
    fit_data &lt;-<span class="st"> </span>fit_data %&gt;%
<span class="st">      </span><span class="kw">select</span>(-home_code, -away_code)
  }
}</code></pre></div>
<p>This filtering process leaves a total of 7811 games between 450 teams. The number of games for each team ranges from 5 to 62.</p>
<p>To estimate the model, the data has to be supplied to Stan in a list format. The names of the elements of the list should match the names of the input data specified in the Stan model (see Section <a href="define-model.html#imp-gri">2.2.1</a> for Stan definition of the game random intercept model).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stan_data &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">num_clubs =</span> <span class="kw">nrow</span>(team_counts),
  <span class="dt">num_games =</span> <span class="kw">nrow</span>(fit_data),
  <span class="dt">home =</span> fit_data$home_code,
  <span class="dt">away =</span> fit_data$away_code,
  <span class="dt">h_goals =</span> fit_data$h_goals,
  <span class="dt">a_goals =</span> fit_data$a_goals,
  <span class="dt">homeg =</span> fit_data$home_game
)</code></pre></div>
<p>In order to later assess model fit with posterior predictive model checks, a <code>generated quantities</code> section was added to the Stan model specification.</p>
<pre class="stan"><code>generated quantities {
  int home_rep[num_games];
  int away_rep[num_games];
  
  for (g in 1:num_games) {
    home_rep[g] = poisson_rng(exp(mu + (eta * homeg[g]) + alpha[home[g]] +
      delta[away[g]] + gamma[g]));
    away_rep[g] = poisson_rng(exp(mu + alpha[away[g]] + delta[home[g]] +
      gamma[g]));
  }
}</code></pre>
<p>This section attempt to replicated the original data. At each each iteration of the chain, the <span class="math inline">\(\lambda\)</span> for each score within each game is calculated using the current values of the parameters. A random Poisson is then drawn for each team using the calculated <span class="math inline">\(\lambda\)</span> values. Thus, the model is able to produce a posterior distribution for the scores of each game. These distribution can then be compared to the observed scores to see how well the model fits the data.</p>
<p>Finally, the model can be estimated using the Stan interface <strong>rstan</strong> <span class="citation">(Guo et al., 2017)</span>. The model is estimated with 3 chains, each with 4000 iterations. The first 2000 iterations from each chain are discarded as burn in. Additionally, a thinning interval of 2 was used. These decisions were made to decrease computation time, and to limit the size of the result <code>stanfit</code> objects, which become quite large. This leaves 1000 iterations from each chain, for a total of 3000 iterations that will make up the final posterior distributions. As in the simulation study, the target proposal acceptance rate during the adaptation period was set to 0.99 <span class="citation">(see Section <a href="simulation.html#model-est">3.2</a>; Stan Development Team, 2016c, 2016a)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rstan)

gri_stanfit &lt;-<span class="st"> </span><span class="kw">stan</span>(<span class="dt">file =</span> <span class="st">&quot;_data/stan-models/gri_ppmc.stan&quot;</span>, <span class="dt">data =</span> stan_data,
  <span class="dt">chains =</span> <span class="dv">3</span>, <span class="dt">iter =</span> <span class="dv">7000</span>, <span class="dt">warmup =</span> <span class="dv">2000</span>, <span class="dt">init =</span> <span class="st">&quot;random&quot;</span>, <span class="dt">thin =</span> <span class="dv">5</span>,
  <span class="dt">cores =</span> <span class="dv">3</span>, <span class="dt">algorithm =</span> <span class="st">&quot;NUTS&quot;</span>, <span class="dt">seed =</span> <span class="dv">71715</span>,
  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.99</span>, <span class="dt">max_treedepth =</span> <span class="dv">15</span>))</code></pre></div>
</div>
<div id="diagnostics" class="section level2">
<h2><span class="header-section-number">5.2</span> MCMC diagnostics</h2>
<p>After estimating the model, before the parameters can be analyzed and inferences can be made, the model has to be checked to make sure it estimated correctly and completely. This diagnostic information is critical to Markov Chain Monte Carlo estimation, as with proper estimation, no valid inferences can be made. The code used to create the plot and tables used to display the diagnostic information can be seen in Appendix <a href="diagnostic-output.html#diagnostic-output">C</a>.</p>
<div id="convergence" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Convergence</h3>
<p>The first check is convergence. Convergence means that the MCMC chain found the high density area of the posterior distribution, and stayed there. When multiple chains are estimated, this can be done by verifying that the estimates from each chain end up in the same place. For a single chain, this means verifying that the chain is sampling roughly the same area at the beginning of the chain (after burn in) as in the end of the chain.</p>
<p>One way to assess convergence is through the <span class="math inline">\(\hat{R}\)</span> statistic <span class="citation">(Brooks &amp; Gelman, 1997; A. Gelman et al., 2014)</span>. The <span class="math inline">\(\hat{R}\)</span> statistic is also known as the potential scale reduction, and is a measure of how much variance there is between chains compared to the amount of variation within chains. Gelman and Rubin <span class="citation">(1992)</span> suggest that in order to conclude the model has successfully converged, all <span class="math inline">\(\hat{R}\)</span> values should be less than 1.1.</p>
<div class="figure" style="text-align: center"><span id="fig:rhat-plot"></span>
<img src="fit-model_files/figure-html/rhat-plot-1.png" alt="Rhat statistics for the estimated game random intercept model." width="80%" />
<p class="caption">
Figure 5.1: Rhat statistics for the estimated game random intercept model.
</p>
</div>
<p>Figure <a href="fit-model.html#fig:rhat-plot">5.1</a> shows that all of the <span class="math inline">\(\hat{R}\)</span> values are below the suggested cutoff of 1.1, indicating that the model has converged.</p>
</div>
<div id="efficiency" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Efficiency</h3>
<p>The second important check for MCMC estimation is the efficiency of the sampler. In other words, it is important to check that the algorithm adequately sampled the full posterior. There are several ways this can be examined. The first is by examing the effective sample size. This diagnostic takes into account the autocorrelation in the chain to determine the ‘effective’ number of independent draws from the posterior. If the chain is slow moving, the draws will be highly autocorrelated, and effective sample size will be well below the total number of iterations in the chain. However, low autocorrelations would indicate that the sampler is moving around the posterior fairly quickly, and the effictive sample size will be at or near the true sample size of the posterior. The effective sample size for all parameters can been seen in Figure <a href="fit-model.html#fig:neff-plot">5.2</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:neff-plot"></span>
<img src="fit-model_files/figure-html/neff-plot-1.png" alt="Effective sample size for the estimated game random intercept model parameters." width="80%" />
<p class="caption">
Figure 5.2: Effective sample size for the estimated game random intercept model parameters.
</p>
</div>
<p>There are also measure of efficiency that are exclusive the No U-Turn Sampler <span class="citation">(NUTS; Hoffman &amp; Gelman, 2014)</span>. For example the Bayesian Factor of Missing Information (BFMI) gives an estimate of how well the sampler adpated and explored the posterior distribution. The BFMI ranges from 0 to 1, with 0 and 1 representing poor and excellent estimation respectively. This is calculated for the chain overall <span class="citation">(Betancourt, 2016)</span>.</p>
<table>
<caption><span id="tab:diag-tab">Table 5.1: </span>Diagnostic statistics for the NUTS algorithm.</caption>
<thead>
<tr class="header">
<th align="center">Chain</th>
<th align="center">BFMI</th>
<th align="center">Mean Acceptance Rate</th>
<th align="center">Max Treedepth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Chain 1</td>
<td align="center">0.847</td>
<td align="center">0.986</td>
<td align="center">7</td>
</tr>
<tr class="even">
<td align="center">Chain 2</td>
<td align="center">0.902</td>
<td align="center">0.989</td>
<td align="center">7</td>
</tr>
<tr class="odd">
<td align="center">Chain 3</td>
<td align="center">0.922</td>
<td align="center">0.983</td>
<td align="center">6</td>
</tr>
</tbody>
</table>
<p>The BFMI values in Table <a href="fit-model.html#tab:diag-tab">5.1</a> indicate that the sampler was able to adequately visit the posterior distributions. Additionally, Table <a href="fit-model.html#tab:diag-tab">5.1</a> shows the mean acceptance rate for each chain. As expected, these values are very close to the 0.99 that was specified when the model was estimated (<code>control = list(adapt_delta = 0.99)</code>; Section <a href="fit-model.html#fit-real-data">5.1</a>). As noted in Sections <a href="simulation.html#model-est">3.2</a> and <a href="fit-model.html#fit-real-data">5.1</a>, a target acceptance rate this high is needed to prevent divergent transitions. This occurs due to the small variances of <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\delta\)</span>, and <span class="math inline">\(\gamma\)</span> that are estimated. The high target acceptance rate forces the sampler to take smaller steps, keeping the variances within reasonable ranges.</p>
<p>The concern with setting the target acceptance this high is that for parameters with wider posteriors, the sampler will not be able to move fast enough. In the NUTS algorithm, at each iteration, the sampler looks for a place to “U-Turn” in a series of possible branches. If the sampler is terminating before the maximum possible tree depth (set to 15; see Section <a href="fit-model.html#fit-real-data">5.1</a>), then the algorithm is able to adequately find good values for the next iteration of the chain. Bumping up against the maximum allowed tree depth, or going beyond it, indicates that stepsize is too small <span class="citation">(Stan Development Team, 2016a, 2016b)</span>. Because the Max Treedepth values in Table <a href="fit-model.html#tab:diag-tab">5.1</a> are all below the maximum specified, and the BFMI values are close to 1, there is strong evidence that the sampler was indeed able to adequately sample the posteriors.</p>
</div>
</div>
<div id="model-fit" class="section level2">
<h2><span class="header-section-number">5.3</span> Model fit</h2>
<p>To assess model fit, I will use posterior predictive model checks. Posterior predictive checks involve simulating replications of the data using the values of the Markov chain, and then comparing the replicated data to the observed data <span class="citation">(A. Gelman et al., 2014)</span>. This means that replicated data sets take into account the uncertainty in the parameter estimates, as a new replicated data set is created at each iteration of the Markov chain. These data sets can then be used to look for systematic differences in the characterics of the observed and simulated data, often through visualizations <span class="citation">(A. Gelman &amp; Hill, 2006)</span>.</p>
<p>The first step is to extract the replicated data sets from the <code>stanfit</code> object using the <strong>purrr</strong> <span class="citation">(Wickham, 2016b)</span> and <strong>tidyr</strong> <span class="citation">(Wickham, 2017)</span> packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(purrr)
<span class="kw">library</span>(tidyr)

home_rep &lt;-<span class="st"> </span>rstan::<span class="kw">extract</span>(gri_stanfit, <span class="dt">pars =</span> <span class="st">&quot;home_rep&quot;</span>,
  <span class="dt">permuted =</span> <span class="ot">TRUE</span>)$home_rep
away_rep &lt;-<span class="st"> </span>rstan::<span class="kw">extract</span>(gri_stanfit, <span class="dt">pars =</span> <span class="st">&quot;away_rep&quot;</span>,
  <span class="dt">permuted =</span> <span class="ot">TRUE</span>)$away_rep

home_rep &lt;-<span class="st"> </span><span class="kw">t</span>(home_rep) %&gt;%
<span class="st">  </span><span class="kw">as_data_frame</span>() %&gt;%<span class="st"> </span><span class="kw">as.list</span>()
away_rep &lt;-<span class="st"> </span><span class="kw">t</span>(away_rep) %&gt;%
<span class="st">  </span><span class="kw">as_data_frame</span>() %&gt;%<span class="st"> </span><span class="kw">as.list</span>()
counter &lt;-<span class="st"> </span><span class="kw">seq_along</span>(home_rep)

rep_data &lt;-<span class="st"> </span><span class="kw">pmap_df</span>(<span class="dt">.l =</span> <span class="kw">list</span>(<span class="dt">h =</span> home_rep, <span class="dt">a =</span> away_rep, <span class="dt">c =</span> counter),
  <span class="dt">.f =</span> function(h, a, c) {
    <span class="kw">data_frame</span>(
      <span class="dt">replication =</span> c,
      <span class="dt">game =</span> <span class="kw">seq_len</span>(<span class="kw">length</span>(h)),
      <span class="dt">home_score =</span> h,
      <span class="dt">away_score =</span> a
    )
  })</code></pre></div>
<div id="ppmc-score-dist" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Score distributions</h3>
<p>The first posterior predictive check to be examined is the distribution of home and away scores. For each replicated data set there is a distribution of goals scored by the home and away teams. To compare to the observed data, we can plot each of these distributions, and then overlay the distribution from the observed data using <strong>ggplot2</strong> <span class="citation">(Wickham &amp; Chang, 2016)</span>. The code for Figure <a href="fit-model.html#fig:plot-score-dist">5.3</a> can be see in Appendix <a href="diagnostic-output.html#ppmc-sdp">C.4</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:plot-score-dist"></span>
<img src="fit-model_files/figure-html/plot-score-dist-1.png" alt="Recovery of observed score distributions." width="80%" />
<p class="caption">
Figure 5.3: Recovery of observed score distributions.
</p>
</div>
<p>Figure <a href="fit-model.html#fig:plot-score-dist">5.3</a> shows that the observed score distributions for both the home and away scores are very similar to what is seen in the replicated data sets. Thus, this provides evidence that the model is able to recover the observed distributions.</p>
</div>
<div id="ppmc-mov-int" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Margin of victory intervals</h3>
<p>It is also possible to examine the margin of victory for each game. In each of the replicated data sets, the home team’s margin of victory for every game can be calculated as replicated home score minus the replicated away score. Doing this for every replication creates a posterior distribution for the home team’s margin of victory in every game. From the posterior we can create credible intervals (Appendix <a href="diagnostic-output.html#ppmc-mov">C.5</a>) and determine how often the observed margin of victory falls outside the credible interval.</p>
<div class="figure" style="text-align: center"><span id="fig:plot-mov-int"></span>
<img src="fit-model_files/figure-html/plot-mov-int-1.png" alt="Example credible interval for game margin of victories." width="80%" />
<p class="caption">
Figure 5.4: Example credible interval for game margin of victories.
</p>
</div>
<p>Figure <a href="fit-model.html#fig:plot-mov-int">5.4</a> shows examples of games where the observed margin of victory fell inside the 50% credible interval, inside the 95% credible interval, and outside both intervals. Overall, for the 7811 games included in the estimation, the observed margin of victory fell within the 50% credible interval 70.2 percent of the time and within the 95% credible 98.0 percent of the time.</p>
</div>
<div id="ppmc-prediction" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Prediction error</h3>
<p>Another posterior check that can be looked at is prediction accuracy. For each replication, whether the home team won, lost, or tied can be determined for each game. Across replications, it is then possible to look at the probability of the home teaming experiencing a given outcome in each game. The probabilities can then be compared to the observed outcome to determine how accurate the predictions were. The accuracy can be determined by using a binary loss function (was the most likely outcome the observed outcome), or a log loss function (how far from the observed outcome was the probability of that outcome).</p>
<p>The first step is to get the probability of the home team winning, tieing, and losing each game.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">outcomes &lt;-<span class="st"> </span>rep_data %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mov =</span> home_score -<span class="st"> </span>away_score) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(game) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(
    <span class="dt">win_prob =</span> <span class="kw">length</span>(<span class="kw">which</span>(mov &gt;<span class="st"> </span><span class="dv">0</span>)) /<span class="st"> </span><span class="kw">n</span>(),
    <span class="dt">tie_prob =</span> <span class="kw">length</span>(<span class="kw">which</span>(mov ==<span class="st"> </span><span class="dv">0</span>)) /<span class="st"> </span><span class="kw">n</span>(),
    <span class="dt">loss_prob =</span> <span class="kw">length</span>(<span class="kw">which</span>(mov &lt;<span class="st"> </span><span class="dv">0</span>)) /<span class="st"> </span><span class="kw">n</span>()
  ) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">most_likely =</span> <span class="kw">ifelse</span>(win_prob &gt;<span class="st"> </span>tie_prob &amp;<span class="st"> </span>win_prob &gt;<span class="st"> </span>loss_prob, <span class="st">&quot;win&quot;</span>,
      <span class="kw">ifelse</span>(tie_prob &gt;<span class="st"> </span>win_prob &amp;<span class="st"> </span>tie_prob &gt;<span class="st"> </span>loss_prob, <span class="st">&quot;tie&quot;</span>, <span class="st">&quot;loss&quot;</span>))
  ) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">obs_mov =</span> fit_data$h_goals -<span class="st"> </span>fit_data$a_goals,
    <span class="dt">outcome =</span> <span class="kw">ifelse</span>(obs_mov &gt;<span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;win&quot;</span>, <span class="kw">ifelse</span>(obs_mov ==<span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;tie&quot;</span>, <span class="st">&quot;loss&quot;</span>))
  )</code></pre></div>
<p>Using the predictions from the replicated data sets, the model gave the observed outcome the highest probability in 53.7 percent of the games.</p>
<p>One problem with this approach is that it doesn’t take into the actual values of the probabilities. For example, take two games where the home team won. In the first game, the home team had a 60 percent chance of winning. In the second game, the home teams had a 90 percent chance of winning. In both cases, the most likely outcome matches the observed outcome, so both instances are assigned a one in the binary loss function as a correct prediction. Alternatively, we could use the log loss function to look at how far the probability was from the observed event <span class="citation">(Altun, Johnson, &amp; Hofmann, 2003)</span>. In this example, the second game would be a better prediction, and have a lower log loss, because a probability of 0.9 is closer to the observed outcome (1) than a probability of 0.6.</p>
<p>The log loss for multiple games is defined in equation <a href="fit-model.html#eq:logloss">(5.1)</a>.</p>
<span class="math display" id="eq:logloss">\[\begin{equation}
logloss = - \frac{1}{N}\sum_{i=1}^N\sum_{j=1}^My_{ij}\log(p_{ij})
\tag{5.1}
\end{equation}\]</span>
<p>In equation <a href="fit-model.html#eq:logloss">(5.1)</a>, <span class="math inline">\(N\)</span> is number of observations (in this case the number of games), <span class="math inline">\(M\)</span> is the number of outcomes (for soccer games this is 3: win, loss, and tie), <span class="math inline">\(y_{ij}\)</span> is a binary indicator of whether outcome <span class="math inline">\(M\)</span> occured for observation <span class="math inline">\(N\)</span> (1) or not (0), and <span class="math inline">\(p_{ij}\)</span> is the probability of outcome <span class="math inline">\(M\)</span> for observation <span class="math inline">\(N\)</span>. Thus, the log loss for a set of predictions is the log of the probability of the observed outcomes, summed over all observations. In the case of perfect predictions, the probability of the observed outcome would be 1, and the log probability would be 0. This means that the closer the log loss is to 0, the better the predictions are <span class="citation">(Roy &amp; McCallum, 2001)</span>.</p>
<p>To calculate the log loss for the estimated game random intercept model, I define a function that takes in a matrix of predictions and a matrix of outcomes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logloss &lt;-<span class="st"> </span>function(pred, obs){
  eps &lt;-<span class="st"> </span><span class="fl">1e-15</span>
  pred &lt;-<span class="st"> </span><span class="kw">pmin</span>(<span class="kw">pmax</span>(pred, eps), <span class="dv">1</span> -<span class="st"> </span>eps)
  (-<span class="dv">1</span> /<span class="st"> </span><span class="kw">nrow</span>(obs)) *<span class="st"> </span><span class="kw">sum</span>(obs *<span class="st"> </span><span class="kw">log</span>(pred) +<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>obs) *<span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> -<span class="st"> </span>pred)) 
}</code></pre></div>
<p>Then, matrices of predictions and outcomes can be created, and the log loss can be calculated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">predictions &lt;-<span class="st"> </span>outcomes %&gt;%
<span class="st">  </span><span class="kw">select</span>(win_prob, tie_prob, loss_prob) %&gt;%
<span class="st">  </span><span class="kw">as.matrix</span>()
observations &lt;-<span class="st"> </span>outcomes %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">obs_win =</span> <span class="kw">ifelse</span>(outcome ==<span class="st"> &quot;win&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),
    <span class="dt">obs_tie =</span> <span class="kw">ifelse</span>(outcome ==<span class="st"> &quot;tie&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),
    <span class="dt">obs_loss =</span> <span class="kw">ifelse</span>(outcome ==<span class="st"> &quot;loss&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)
  ) %&gt;%
<span class="st">  </span><span class="kw">select</span>(obs_win, obs_tie, obs_loss) %&gt;%
<span class="st">  </span><span class="kw">as.matrix</span>()
avg_logloss &lt;-<span class="st"> </span><span class="kw">logloss</span>(<span class="dt">pred =</span> predictions, <span class="dt">obs =</span> observations)</code></pre></div>
<p>The log loss for predictions from the replicated data sets is 1.716. Converting back to a probability scale, on average, the probability of the observed outcome was off by 0.18. In isolation, the log loss can be hard to interpret. Instead, it is often useful to compare to baseline models.</p>
<table>
<caption><span id="tab:logloss-tab">Table 5.2: </span>Log loss comparison to baseline models.</caption>
<thead>
<tr class="header">
<th align="center">Model</th>
<th align="center">Log Loss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Game Random Intercept</td>
<td align="center">1.72</td>
</tr>
<tr class="even">
<td align="center">Data Average</td>
<td align="center">1.86</td>
</tr>
<tr class="odd">
<td align="center">Equal Probabilities</td>
<td align="center">1.91</td>
</tr>
<tr class="even">
<td align="center">Home Win</td>
<td align="center">37.70</td>
</tr>
</tbody>
</table>
<p>Table <a href="fit-model.html#tab:logloss-tab">5.2</a> shows the log loss for a variety of models. In the data average model, the probability of each outcome is set to the overall average for the entire data set. In the equal probabilities model, the probability for each outcome is set to 0.33. Finally, in the home win model, the probability of the home team winning is set to 1 and the probability of the other outcomes is set to 0. The posterior predictive probabilities from the game random intercept model out perform all of these baseline models.</p>
</div>
<div id="posterior-predictive-check-summary" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Posterior predictive check summary</h3>
<p>Overall, the posterior predictive model checks indicate adequate model fit. The model is able to accurately recover the distributions of scores for both the home and away teams (Figure <a href="fit-model.html#fig:plot-score-dist">5.3</a>). Additionally, when looking at individual games, the credible intervals for the margin of victory are able to consistently capture the observed margin of victory. Finally, the prediction error shows that the model’s predictions are able to more accurately pick game outcomes than a variety of baseline models.</p>
<p>Taken in totality, there is sufficient evidence of model fit for us to proceed with the analysis and examine the posterior distributions of the parameter estimates.</p>
</div>
</div>
<div id="results" class="section level2">
<h2><span class="header-section-number">5.4</span> Results</h2>
<p>A ranking of the teams can be created by the goals they would be expected to score and concede against an average team at a neutral location. The larger the difference between these expected goals, the better team. First we pull out the parameters we need from the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">params &lt;-<span class="st"> </span>rstan::<span class="kw">extract</span>(gri_stanfit, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;delta&quot;</span>))
alpha &lt;-<span class="st"> </span><span class="kw">colMeans</span>(params$alpha)
delta &lt;-<span class="st"> </span><span class="kw">colMeans</span>(params$delta)
mu &lt;-<span class="st"> </span><span class="kw">mean</span>(params$mu)</code></pre></div>
<p>Then we can compute the expected offense, defense, and margin for each team to create the rankings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rankings &lt;-<span class="st"> </span><span class="kw">data_frame</span>(
  <span class="dt">Club =</span> team_counts$team,
  <span class="dt">Attacking =</span> alpha,
  <span class="dt">Defense =</span> delta
) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="st">`</span><span class="dt">Expected Offense</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(mu +<span class="st"> </span>alpha),
    <span class="st">`</span><span class="dt">Expected Defense</span><span class="st">`</span> =<span class="st"> </span><span class="kw">exp</span>(mu +<span class="st"> </span>delta),
    <span class="st">`</span><span class="dt">Expected Margin</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">Expected Offense</span><span class="st">`</span> -<span class="st"> `</span><span class="dt">Expected Defense</span><span class="st">`</span>
  ) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(<span class="st">`</span><span class="dt">Expected Margin</span><span class="st">`</span>)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">Attacking =</span> <span class="kw">formatC</span>(Attacking, <span class="dt">digits =</span> <span class="dv">3</span>, <span class="dt">drop0trailing =</span> <span class="ot">FALSE</span>,
      <span class="dt">format =</span> <span class="st">&quot;f&quot;</span>),
    <span class="dt">Defense =</span> <span class="kw">formatC</span>(Defense, <span class="dt">digits =</span> <span class="dv">3</span>, <span class="dt">drop0trailing =</span> <span class="ot">FALSE</span>,
      <span class="dt">format =</span> <span class="st">&quot;f&quot;</span>),
    <span class="st">`</span><span class="dt">Expected Offense</span><span class="st">`</span> =<span class="st"> </span><span class="kw">formatC</span>(<span class="st">`</span><span class="dt">Expected Offense</span><span class="st">`</span>, <span class="dt">digits =</span> <span class="dv">2</span>,
      <span class="dt">drop0trailing =</span> <span class="ot">FALSE</span>, <span class="dt">format =</span> <span class="st">&quot;f&quot;</span>),
    <span class="st">`</span><span class="dt">Expected Defense</span><span class="st">`</span> =<span class="st"> </span><span class="kw">formatC</span>(<span class="st">`</span><span class="dt">Expected Defense</span><span class="st">`</span>, <span class="dt">digits =</span> <span class="dv">2</span>,
      <span class="dt">drop0trailing =</span> <span class="ot">FALSE</span>, <span class="dt">format =</span> <span class="st">&quot;f&quot;</span>),
    <span class="st">`</span><span class="dt">Expected Margin</span><span class="st">`</span> =<span class="st"> </span><span class="kw">formatC</span>(<span class="st">`</span><span class="dt">Expected Margin</span><span class="st">`</span>, <span class="dt">digits =</span> <span class="dv">2</span>,
      <span class="dt">drop0trailing =</span> <span class="ot">FALSE</span>, <span class="dt">format =</span> <span class="st">&quot;f&quot;</span>)
  )</code></pre></div>
<p>As we might expect, the top of the list is dominated by team leading the best European leagues and having success in the Champions League. Barcelona comes in as the top team in rankings, followed by Bayern Munich, Paris Saint-Germain, Real Madrid, and AS Monaco to round out the top 5. The top offense belongs to Barcelona according to the model, while FC Copenhagen boasts the best defense.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT::<span class="kw">datatable</span>(<span class="kw">select</span>(rankings, -Club), <span class="dt">rownames =</span> rankings$Club,
  <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">pageLength =</span> <span class="dv">10</span>, <span class="dt">scrollX =</span> <span class="ot">TRUE</span>,
  <span class="dt">columnDefs =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">className =</span> <span class="st">&#39;dt-center&#39;</span>, <span class="dt">targets =</span> <span class="dv">1</span>:<span class="dv">5</span>))),
  <span class="dt">caption =</span> <span class="st">&quot;Club rankings from game random intercept model&quot;</span>)</code></pre></div>
<div id="htmlwidget-27bd867acf4efb0774ff" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-27bd867acf4efb0774ff">{"x":{"filter":"none","caption":"<caption>Club rankings from game random intercept model<\/caption>","data":[["Barcelona","Bayern Munich","Paris Saint-Germain","Real Madrid","AS Monaco","Chelsea","Tottenham Hotspur","Juventus","Manchester City","Arsenal","Celtic","Feyenoord Rotterdam","Borussia Dortmund","Liverpool","Ajax Amsterdam","AS Roma","FC Copenhagen","FC Porto","Manchester United","Napoli","Atletico Madrid","Shakhtar Donetsk","Benfica","Anderlecht","PSV Eindhoven","Newcastle United","FC Basel","FC Salzburg","Zenit St Petersburg","Lyon","Besiktas","Brighton &amp; Hove Albion","TSG Hoffenheim","Lazio","Olympiakos","RB Leipzig","Fenerbahce","Fulham","Istanbul Basaksehir","Norwich City","Everton","Schalke 04","Brøndby","Lincoln City","Aberdeen","Sporting CP","Atalanta","PAOK Salonika","Rostov","Galatasaray","Tranmere","Sheff Utd","Sevilla FC","Spartak Moscow","Levante","Racing Genk","Club Brugge","Torino","Luton Town","Nice","VfB Stuttgart","Marseille","Hannover 96","CSKA Moscow","KAA Gent","Spal","Villarreal","Internazionale","Fiorentina","Borussia Monchengladbach","Dover","AC Milan","Panathinaikos","Young Boys","Krasnodar","Bolton Wanderers","Athletic Bilbao","FC Midtjylland","Guimaraes","Brentford","Dagenham &amp; Redbridge","Lens","TSV Eintracht Braunschweig","Celta Vigo","Plymouth Argyle","KV Oostende","Real Sociedad","Hellas Verona","FC Utrecht","Leeds United","Aldershot","FC Union Berlin","Braga","Dynamo Kiev","Eibar","FC Cologne","Austria Vienna","Sheffield Wednesday","Bayer Leverkusen","Strasbourg","Rangers","Southampton","Portsmouth","Blackpool","Vitesse Arnhem","Bradford","Gateshead","Hertha Berlin","Lokomotiv Moscow","SC Amiens","Leicester City","Barrow","Halifax","F Green","Hibernian","Huddersfield Town","Standard Liege","Apoel Nicosia","Nimes","Werder Bremen","Oxford United","Perugia","Getafe","Preston North End","Huesca","Reading","Scunthorpe","Derby County","Zulte-Waregem","Troyes","Frosinone","Exeter City","Cádiz","Bordeaux","Dynamo Dresden","Girona","Barnsley","Espanyol","Trabzonspor","Millwall","Alavés","West Bromwich Albion","OSM","Royal Charleroi SC","Wycombe Wanderers","Benevento","Sevilla At.","Fleetwood Town","Hapoel Be'e","Toulouse","FC Nordsjaelland","Bristol City","Eintracht Frankfurt","Brest","Heerenveen","Lugo","Crystal Palace","Rapid Vienna","Middlesbrough","St Etienne","GFC Ajaccio","AFC Bournemouth","Cesena","FC Sion","Doncaster","Sampdoria","Colchester","Rochdale","Stade de Reims","Burnley","St Johnstone","Le Havre AC","York","Aston Villa","Ludogorets","Elche","FK Rubin Kazan","Cambridge United","Heart of Midlothian","Swansea City","Cardiff City","Valenciennes","SV Sandhausen","FC Groningen","Real Valladolid","Wolverhampton Wanderers","Grimsby","SC Rheindorf","Terek Grozny","Mainz","Tenerife","Heidenheimer SB","Cittadella","R Zaragoza","AEK Athens","Stevenage","Macclesfield Town","Antalyaspor","Panionios","Sassuolo","Hull City","Virtus Entel","FK Amkar Perm","Accrington Stanley","Steaua Bucuresti","Udinese","FC Xanthi","Maritimo","Spezia","Evian Thonon Gaillard","SK Sturm Gra","Rio Ave","Carlisle","Stoke City","Kasimpasa","Mansfield","Randers FC","Liberec","Genclerbirligi","Morton","Sochaux","FC Twente","Charlton Athletic","Almeria","Jerusalem","Valencia","Ipswich Town","Tours","Blackburn Rovers","Salernitana","Lucerne","Las Palmas","FC Zürich","Lille","Lyngby","Guingamp","Rayo","Sutton United","Partick Thistle","St Pauli","Bologna","Mallorca","Málaga","Queens Park Rangers","Kaiserslautern","Angers","West Ham United","AZ Alkmaar","Clermont Foot","FC Zorya Luh","Numancia","Chievo Verona","AFC Wimbledon","Milton Keynes Dons","Watford","Dijon FCO","Sparta Prague","Platanias","FC Astana","VfL Bochum","GD Chaves","Reus Deporti","Viktoria Plzen","AaB","Nottingham Forest","Boavista","Carpi","KV Mechelen","FK Astra Giu","St. Truiden","Würzburger Kickers","Nurnberg","SpVgg Greuther Furth","Atromitos","AJ Auxerre","FC Ufa","Maccabi Tel-Aviv","Ascoli","Cagliari","UCAM Murcia","Southend","Burton Albion","Birmingham City","FK Qarabag","Bari","Boreham Wood","Eastleigh","Karabükspor","Novara","Alanyaspor K","Konyaspor","Bourg-Peronnas","VfL Wolfsburg","Krylia Sovetov","Bristol Rovers","Fortuna Düsseldorf","Legia Warsaw","FC Augsburg","Sonderjyske","SC Heracles Almelo","Vitoria Setubal","Akhisar","SC Freiburg","Iraklis","TSV 1860 Munich","FC Lugano","Cordoba","Admira Wacke","Peterborough United","Arminia Bielefeld","Deportivo La Coruña","Pisa","Orenburg","Gimnastic de Tarragona","Montpellier","Anzhi Makhachkala","Dundalk","Estoril","Eupen","Cork","Kayserispor","Lausanne Spo","St. Pölten","Larissa FC","Odense Boldk","AS Nancy Lorraine","Paços de Ferreira","Oldham","Niort","Barnet","AC Ajaccio","Nantes","Orléans","FC Ingolstadt 04","AGF Aarhus","Torquay","Walsall","Stade Rennes","FC Thun","Guiseley","Real Oviedo","KV Kortrijk","Yeovil Town","AD Alcorcon","Real Betis","FK Qabala","Wigan Athletic","Brescia","Stade Laval","Latina","Trapani","Pro Vercelli","Grasshoppers","Waasland-Bev","FC Erzgebirge Aue","Viitorul Con","Asteras Trip","Lokeren","Cheltenham Town","US Avellino","Viborg FF","Ross County","Sparta Rotterdam","Panetolikos","Bursaspor","Wrexham","Willem II Tilburg","Maidstone United","Woking","Bury","Leganes","Ternana","Solihull Moors","Dinamo Zagreb","Lorient","St Gallen","Northampton Town","Caykur Rizespor","RZ Pellets W","Hamburg SV","Red Star FC 93","Vicenza","Genoa","Crotone","Mattersburg","Chester FC","Levadiakos","Bromley","Esbjerg FB","Crawley Town","Gillingham","Notts County","Sunderland","Shrewsbury Town","Excelsior","Feirense","Arouca","Gaziantepspor","Dundee","Moreirense","Belenenses","Kerkyra","Kilmarnock","SV Josko Rie","Newport County","Pas Giannina","Ural","Empoli","Morecambe","ADO Den Haag","Sporting Gijón","Bastia","AC Horsens","FC Arsenal T","Crewe","Hartlepool","Port Vale","Swindon Town","Braintree Town","Roda JC Kerkrade","Silkeborg IF","Hamilton Academical","Coventry City","SV Darmstadt 98","L Orient","Mirandes","Veria","FC Vaduz","PEC Zwolle","Caen","Metz","Westerlo","Chesterfield","NEC Nijmegen","Tondela","Motherwell","Adanaspor","US Pescara","Palermo","Karlsruher SC","Southport","CD Nacional de Madeira","Inverness Caledonian Thistle","Osasuna","Granada","Go Ahead Eagles","Mouscron-Per","Rotherham United","North Ferrib","FK Tom Tomsk"],["0.764","0.686","0.620","0.709","0.659","0.585","0.523","0.435","0.520","0.571","0.532","0.464","0.534","0.477","0.447","0.492","0.336","0.366","0.361","0.492","0.285","0.415","0.342","0.391","0.314","0.356","0.372","0.297","0.346","0.412","0.389","0.278","0.319","0.331","0.204","0.288","0.259","0.376","0.289","0.439","0.272","0.242","0.259","0.250","0.219","0.278","0.247","0.159","0.098","0.312","0.176","0.226","0.217","0.219","0.235","0.235","0.201","0.342","0.222","0.178","0.252","0.196","0.208","0.061","0.133","0.203","0.065","0.292","0.239","0.190","0.349","0.148","0.065","0.251","0.055","0.053","0.116","0.228","0.181","0.232","0.168","0.133","0.085","0.177","0.074","0.169","0.182","0.169","0.113","0.052","0.055","0.133","0.156","0.068","0.162","0.093","0.309","0.037","0.160","0.194","0.088","0.010","0.123","0.049","0.095","-0.017","0.062","0.023","0.047","0.073","0.144","0.100","0.119","0.109","0.057","0.049","0.102","0.012","0.076","0.231","0.129","0.049","0.025","0.149","0.007","0.149","0.145","-0.011","0.130","0.102","0.053","0.127","0.091","0.080","0.132","0.100","0.128","0.016","-0.062","0.123","-0.100","0.014","-0.011","-0.129","0.047","-0.001","0.038","-0.019","-0.044","-0.082","0.180","0.055","-0.124","0.011","0.151","0.088","0.084","0.021","-0.082","-0.162","0.008","0.154","0.050","0.141","0.075","-0.020","0.057","0.120","-0.033","-0.070","-0.002","-0.145","0.087","-0.120","0.040","0.025","-0.106","-0.023","0.100","0.140","0.025","-0.014","0.025","0.088","0.008","-0.028","-0.042","0.105","0.017","0.082","-0.088","-0.018","0.071","-0.037","-0.076","0.083","-0.032","-0.008","-0.122","0.073","0.048","0.013","-0.152","-0.063","-0.053","0.005","-0.132","-0.137","-0.178","-0.084","-0.047","-0.038","0.070","-0.052","0.005","-0.084","-0.035","0.041","-0.196","0.008","-0.196","0.028","-0.081","-0.045","-0.044","0.125","-0.150","0.067","-0.041","-0.153","0.149","0.171","-0.072","-0.144","-0.187","-0.009","-0.166","-0.025","-0.153","-0.150","-0.072","-0.099","0.006","-0.049","-0.237","-0.073","0.054","0.091","-0.061","-0.172","-0.094","-0.065","-0.084","0.014","-0.068","0.007","-0.070","0.011","-0.069","-0.051","-0.132","-0.237","-0.096","-0.203","0.048","-0.212","-0.202","-0.044","-0.137","-0.003","-0.207","0.077","-0.164","-0.079","-0.230","-0.333","-0.124","-0.110","0.111","-0.102","-0.078","-0.112","-0.142","-0.071","-0.211","-0.202","-0.031","-0.147","-0.071","0.146","-0.148","0.025","-0.153","-0.133","0.058","-0.127","0.029","-0.085","-0.085","0.018","-0.229","-0.176","0.013","-0.133","-0.143","0.009","-0.155","-0.126","-0.007","0.033","-0.055","-0.472","-0.176","-0.109","0.062","-0.213","-0.173","-0.187","0.075","-0.109","0.041","0.062","-0.122","-0.225","-0.210","-0.299","-0.146","-0.356","-0.065","-0.104","-0.035","-0.194","-0.166","-0.119","-0.133","-0.090","-0.135","-0.228","0.062","-0.212","-0.047","0.101","-0.088","-0.397","-0.134","-0.094","-0.293","-0.075","-0.255","-0.259","-0.127","-0.277","-0.128","-0.211","-0.090","-0.086","-0.037","-0.373","-0.170","-0.185","-0.208","-0.104","-0.019","-0.178","-0.148","-0.280","-0.303","-0.059","0.030","0.016","-0.259","-0.201","0.009","-0.215","0.005","-0.203","-0.012","-0.104","-0.170","-0.115","-0.161","-0.276","-0.099","-0.256","-0.223","0.040","-0.218","-0.192","-0.132","-0.129","-0.006","-0.098","-0.282","-0.237","-0.086","-0.230","-0.176","-0.189","-0.165","-0.234","-0.322","-0.181","-0.282","-0.117","-0.153","-0.239","-0.239","-0.365","0.022","-0.166","-0.108","-0.330","-0.134","-0.339","-0.090","-0.177","-0.269","-0.254","-0.136","-0.374","-0.098","-0.290","-0.248","-0.241","-0.142","-0.155","-0.129","-0.073","-0.119","-0.153","-0.183","-0.091","-0.192","-0.281","-0.329","-0.112","-0.212","-0.183","-0.261","-0.365","-0.113","-0.413","-0.165","-0.169","-0.314","-0.211","-0.274","-0.190","-0.390","-0.362"],["-0.257","-0.425","-0.387","-0.127","-0.155","-0.324","-0.403","-0.513","-0.281","-0.169","-0.222","-0.322","-0.165","-0.278","-0.314","-0.215","-0.550","-0.460","-0.447","-0.152","-0.468","-0.188","-0.305","-0.195","-0.334","-0.255","-0.206","-0.300","-0.209","-0.086","-0.097","-0.255","-0.184","-0.155","-0.358","-0.205","-0.229","-0.039","-0.173","0.071","-0.178","-0.200","-0.172","-0.185","-0.213","-0.118","-0.144","-0.268","-0.359","-0.011","-0.195","-0.122","-0.133","-0.130","-0.103","-0.099","-0.141","0.058","-0.100","-0.149","-0.037","-0.105","-0.084","-0.280","-0.179","-0.078","-0.266","0.051","-0.016","-0.078","0.130","-0.120","-0.227","0.022","-0.228","-0.231","-0.144","0.002","-0.057","0.009","-0.064","-0.110","-0.170","-0.045","-0.175","-0.053","-0.030","-0.046","-0.114","-0.189","-0.184","-0.081","-0.048","-0.157","-0.040","-0.119","0.142","-0.184","-0.032","0.013","-0.108","-0.196","-0.053","-0.141","-0.084","-0.216","-0.119","-0.161","-0.130","-0.093","-0.009","-0.054","-0.032","-0.042","-0.102","-0.109","-0.041","-0.144","-0.065","0.113","-0.003","-0.092","-0.119","0.027","-0.132","0.029","0.028","-0.149","0.012","-0.018","-0.072","0.011","-0.027","-0.037","0.022","-0.006","0.028","-0.096","-0.179","0.029","-0.218","-0.088","-0.116","-0.243","-0.036","-0.087","-0.043","-0.104","-0.126","-0.166","0.116","-0.016","-0.210","-0.062","0.089","0.022","0.021","-0.045","-0.153","-0.239","-0.056","0.103","-0.005","0.093","0.025","-0.076","0.007","0.074","-0.086","-0.124","-0.041","-0.185","0.056","-0.158","0.008","-0.007","-0.143","-0.055","0.073","0.114","-0.001","-0.041","-0.000","0.065","-0.012","-0.047","-0.059","0.092","0.004","0.071","-0.100","-0.029","0.061","-0.046","-0.079","0.081","-0.032","-0.005","-0.118","0.078","0.054","0.021","-0.143","-0.053","-0.043","0.016","-0.118","-0.122","-0.161","-0.068","-0.031","-0.019","0.086","-0.034","0.024","-0.063","-0.014","0.065","-0.165","0.033","-0.165","0.054","-0.053","-0.012","-0.010","0.155","-0.108","0.102","0.000","-0.106","0.185","0.208","-0.024","-0.090","-0.128","0.041","-0.105","0.029","-0.089","-0.086","-0.010","-0.035","0.067","0.016","-0.160","-0.006","0.113","0.150","0.014","-0.087","-0.013","0.015","-0.001","0.095","0.021","0.091","0.022","0.097","0.023","0.042","-0.031","-0.125","0.003","-0.089","0.140","-0.094","-0.085","0.057","-0.025","0.096","-0.083","0.172","-0.043","0.033","-0.100","-0.188","-0.005","0.009","0.207","0.017","0.040","0.012","-0.014","0.050","-0.070","-0.061","0.090","-0.011","0.057","0.254","-0.006","0.147","-0.006","0.013","0.183","0.025","0.164","0.066","0.066","0.157","-0.054","-0.009","0.154","0.030","0.023","0.155","0.016","0.041","0.143","0.180","0.106","-0.235","0.005","0.064","0.210","-0.021","0.014","0.002","0.227","0.072","0.199","0.217","0.063","-0.021","-0.008","-0.079","0.046","-0.121","0.120","0.088","0.145","0.015","0.037","0.077","0.068","0.105","0.070","-0.002","0.236","0.012","0.152","0.276","0.120","-0.119","0.086","0.119","-0.039","0.135","-0.008","-0.011","0.094","-0.020","0.098","0.036","0.136","0.141","0.184","-0.074","0.085","0.075","0.061","0.147","0.215","0.095","0.118","0.020","0.003","0.188","0.259","0.248","0.042","0.085","0.248","0.078","0.248","0.090","0.239","0.169","0.120","0.162","0.131","0.048","0.181","0.066","0.091","0.293","0.100","0.120","0.175","0.180","0.272","0.205","0.073","0.106","0.216","0.116","0.157","0.150","0.168","0.122","0.062","0.160","0.090","0.207","0.185","0.125","0.126","0.047","0.319","0.189","0.232","0.080","0.221","0.087","0.258","0.199","0.140","0.151","0.232","0.080","0.264","0.143","0.179","0.186","0.253","0.249","0.270","0.320","0.290","0.272","0.257","0.331","0.270","0.217","0.190","0.325","0.264","0.291","0.244","0.194","0.350","0.183","0.339","0.343","0.269","0.330","0.316","0.383","0.317","0.366"],["2.30","2.13","1.99","2.18","2.07","1.93","1.81","1.66","1.80","1.90","1.83","1.71","1.83","1.73","1.68","1.75","1.50","1.55","1.54","1.76","1.43","1.62","1.51","1.59","1.47","1.53","1.56","1.44","1.52","1.62","1.58","1.42","1.48","1.49","1.32","1.43","1.39","1.56","1.43","1.66","1.41","1.37","1.39","1.38","1.34","1.42","1.37","1.26","1.18","1.47","1.28","1.35","1.33","1.34","1.36","1.36","1.31","1.51","1.34","1.28","1.38","1.31","1.32","1.14","1.23","1.32","1.15","1.44","1.36","1.30","1.52","1.24","1.14","1.38","1.13","1.13","1.21","1.35","1.29","1.35","1.27","1.23","1.17","1.28","1.16","1.27","1.29","1.27","1.20","1.13","1.13","1.23","1.25","1.15","1.26","1.18","1.46","1.11","1.26","1.30","1.17","1.08","1.21","1.13","1.18","1.06","1.14","1.10","1.13","1.15","1.24","1.19","1.21","1.20","1.14","1.13","1.19","1.09","1.16","1.35","1.22","1.13","1.10","1.25","1.08","1.25","1.24","1.06","1.22","1.19","1.13","1.22","1.18","1.16","1.22","1.19","1.22","1.09","1.01","1.21","0.97","1.09","1.06","0.94","1.12","1.07","1.11","1.05","1.03","0.99","1.28","1.13","0.95","1.08","1.25","1.17","1.17","1.10","0.99","0.91","1.08","1.25","1.13","1.24","1.16","1.05","1.14","1.21","1.04","1.00","1.07","0.93","1.17","0.95","1.12","1.10","0.96","1.05","1.19","1.23","1.10","1.06","1.10","1.17","1.08","1.04","1.03","1.19","1.09","1.17","0.98","1.05","1.15","1.03","0.99","1.17","1.04","1.06","0.95","1.15","1.13","1.09","0.92","1.01","1.02","1.08","0.94","0.94","0.90","0.99","1.02","1.03","1.15","1.02","1.08","0.99","1.04","1.12","0.88","1.08","0.88","1.10","0.99","1.03","1.03","1.22","0.92","1.15","1.03","0.92","1.25","1.27","1.00","0.93","0.89","1.06","0.91","1.05","0.92","0.92","1.00","0.97","1.08","1.02","0.85","1.00","1.13","1.18","1.01","0.90","0.98","1.01","0.99","1.09","1.00","1.08","1.00","1.09","1.00","1.02","0.94","0.85","0.98","0.88","1.13","0.87","0.88","1.03","0.94","1.07","0.87","1.16","0.91","0.99","0.85","0.77","0.95","0.96","1.20","0.97","0.99","0.96","0.93","1.00","0.87","0.88","1.04","0.93","1.00","1.24","0.93","1.10","0.92","0.94","1.14","0.95","1.10","0.99","0.99","1.09","0.85","0.90","1.09","0.94","0.93","1.08","0.92","0.95","1.07","1.11","1.02","0.67","0.90","0.96","1.14","0.87","0.90","0.89","1.16","0.96","1.12","1.14","0.95","0.86","0.87","0.80","0.93","0.75","1.01","0.97","1.04","0.88","0.91","0.95","0.94","0.98","0.94","0.85","1.14","0.87","1.02","1.19","0.98","0.72","0.94","0.98","0.80","1.00","0.83","0.83","0.94","0.81","0.94","0.87","0.98","0.98","1.03","0.74","0.91","0.89","0.87","0.97","1.05","0.90","0.93","0.81","0.79","1.01","1.11","1.09","0.83","0.88","1.08","0.87","1.08","0.88","1.06","0.97","0.91","0.96","0.91","0.81","0.97","0.83","0.86","1.12","0.86","0.89","0.94","0.94","1.07","0.97","0.81","0.85","0.98","0.85","0.90","0.89","0.91","0.85","0.78","0.90","0.81","0.95","0.92","0.85","0.85","0.75","1.10","0.91","0.96","0.77","0.94","0.77","0.98","0.90","0.82","0.83","0.94","0.74","0.97","0.80","0.84","0.84","0.93","0.92","0.94","1.00","0.95","0.92","0.89","0.98","0.89","0.81","0.77","0.96","0.87","0.89","0.83","0.75","0.96","0.71","0.91","0.91","0.78","0.87","0.82","0.89","0.73","0.75"],["0.83","0.70","0.73","0.94","0.92","0.78","0.72","0.64","0.81","0.91","0.86","0.78","0.91","0.81","0.78","0.87","0.62","0.68","0.69","0.92","0.67","0.89","0.79","0.88","0.77","0.83","0.87","0.80","0.87","0.99","0.97","0.83","0.89","0.92","0.75","0.87","0.85","1.03","0.90","1.15","0.90","0.88","0.90","0.89","0.87","0.95","0.93","0.82","0.75","1.06","0.88","0.95","0.94","0.94","0.97","0.97","0.93","1.14","0.97","0.92","1.03","0.97","0.99","0.81","0.90","0.99","0.82","1.13","1.06","0.99","1.22","0.95","0.86","1.10","0.85","0.85","0.93","1.08","1.01","1.08","1.01","0.96","0.91","1.03","0.90","1.02","1.04","1.02","0.96","0.89","0.89","0.99","1.02","0.92","1.03","0.95","1.24","0.89","1.04","1.09","0.96","0.88","1.02","0.93","0.99","0.87","0.95","0.91","0.94","0.98","1.06","1.02","1.04","1.03","0.97","0.96","1.03","0.93","1.01","1.20","1.07","0.98","0.95","1.10","0.94","1.11","1.10","0.92","1.09","1.05","1.00","1.09","1.04","1.03","1.10","1.07","1.10","0.98","0.90","1.10","0.86","0.98","0.96","0.84","1.04","0.98","1.03","0.97","0.95","0.91","1.21","1.06","0.87","1.01","1.17","1.10","1.10","1.03","0.92","0.85","1.02","1.19","1.07","1.18","1.10","0.99","1.08","1.16","0.98","0.95","1.03","0.89","1.14","0.92","1.08","1.07","0.93","1.02","1.15","1.20","1.07","1.03","1.07","1.15","1.06","1.02","1.01","1.18","1.08","1.15","0.97","1.04","1.14","1.02","0.99","1.16","1.04","1.07","0.95","1.16","1.13","1.10","0.93","1.02","1.03","1.09","0.95","0.95","0.91","1.00","1.04","1.05","1.17","1.04","1.10","1.01","1.06","1.14","0.91","1.11","0.91","1.13","1.02","1.06","1.06","1.25","0.96","1.19","1.07","0.97","1.29","1.32","1.05","0.98","0.94","1.12","0.97","1.11","0.98","0.99","1.06","1.04","1.15","1.09","0.91","1.07","1.20","1.25","1.09","0.98","1.06","1.09","1.07","1.18","1.10","1.18","1.10","1.18","1.10","1.12","1.04","0.95","1.08","0.98","1.23","0.98","0.99","1.14","1.05","1.18","0.99","1.27","1.03","1.11","0.97","0.89","1.07","1.08","1.32","1.09","1.12","1.09","1.06","1.13","1.00","1.01","1.17","1.06","1.14","1.38","1.07","1.24","1.07","1.09","1.29","1.10","1.26","1.15","1.15","1.26","1.02","1.06","1.25","1.11","1.10","1.25","1.09","1.12","1.24","1.29","1.19","0.85","1.08","1.14","1.32","1.05","1.09","1.08","1.35","1.15","1.31","1.33","1.14","1.05","1.06","0.99","1.12","0.95","1.21","1.17","1.24","1.09","1.11","1.16","1.15","1.19","1.15","1.07","1.36","1.09","1.25","1.41","1.21","0.95","1.17","1.21","1.03","1.23","1.06","1.06","1.18","1.05","1.18","1.11","1.23","1.24","1.29","1.00","1.17","1.16","1.14","1.24","1.33","1.18","1.21","1.09","1.08","1.30","1.39","1.38","1.12","1.17","1.38","1.16","1.38","1.17","1.36","1.27","1.21","1.26","1.22","1.13","1.29","1.15","1.18","1.44","1.19","1.21","1.28","1.29","1.41","1.32","1.15","1.19","1.33","1.20","1.26","1.25","1.27","1.21","1.14","1.26","1.17","1.32","1.29","1.22","1.22","1.12","1.48","1.30","1.35","1.16","1.34","1.17","1.39","1.31","1.23","1.25","1.35","1.16","1.40","1.24","1.28","1.29","1.38","1.38","1.41","1.48","1.43","1.41","1.39","1.49","1.41","1.33","1.30","1.49","1.40","1.44","1.37","1.30","1.52","1.29","1.51","1.51","1.40","1.49","1.47","1.57","1.47","1.55"],["1.47","1.43","1.27","1.24","1.16","1.15","1.09","1.02","0.99","0.99","0.97","0.93","0.92","0.92","0.89","0.89","0.88","0.87","0.85","0.83","0.76","0.74","0.72","0.70","0.70","0.70","0.68","0.65","0.65","0.64","0.61","0.59","0.58","0.58","0.57","0.56","0.54","0.53","0.53","0.51","0.51","0.49","0.49","0.49","0.47","0.46","0.44","0.44","0.43","0.40","0.40","0.40","0.39","0.39","0.39","0.38","0.38","0.37","0.37","0.36","0.35","0.34","0.34","0.33","0.33","0.32","0.32","0.31","0.31","0.30","0.30","0.29","0.29","0.28","0.28","0.28","0.28","0.27","0.27","0.27","0.26","0.26","0.26","0.26","0.25","0.25","0.25","0.25","0.24","0.24","0.24","0.24","0.23","0.23","0.23","0.23","0.22","0.22","0.22","0.22","0.21","0.20","0.20","0.20","0.19","0.19","0.19","0.18","0.18","0.18","0.18","0.17","0.17","0.17","0.17","0.16","0.16","0.16","0.15","0.15","0.15","0.15","0.15","0.14","0.14","0.14","0.14","0.14","0.14","0.13","0.13","0.13","0.13","0.13","0.13","0.12","0.12","0.12","0.11","0.11","0.11","0.11","0.11","0.10","0.09","0.09","0.09","0.09","0.08","0.08","0.08","0.08","0.08","0.08","0.07","0.07","0.07","0.07","0.07","0.07","0.07","0.06","0.06","0.06","0.06","0.06","0.06","0.05","0.05","0.05","0.04","0.04","0.04","0.04","0.04","0.03","0.03","0.03","0.03","0.03","0.03","0.03","0.03","0.03","0.02","0.02","0.02","0.02","0.01","0.01","0.01","0.01","0.01","0.01","0.00","0.00","0.00","-0.00","-0.00","-0.01","-0.01","-0.01","-0.01","-0.01","-0.01","-0.01","-0.01","-0.01","-0.01","-0.02","-0.02","-0.02","-0.02","-0.02","-0.02","-0.02","-0.02","-0.03","-0.03","-0.03","-0.03","-0.03","-0.03","-0.03","-0.04","-0.04","-0.04","-0.04","-0.04","-0.04","-0.05","-0.05","-0.05","-0.05","-0.05","-0.06","-0.06","-0.06","-0.06","-0.06","-0.06","-0.06","-0.07","-0.07","-0.07","-0.07","-0.07","-0.07","-0.08","-0.08","-0.08","-0.08","-0.09","-0.09","-0.09","-0.09","-0.10","-0.10","-0.10","-0.10","-0.10","-0.10","-0.10","-0.11","-0.11","-0.11","-0.11","-0.11","-0.11","-0.11","-0.11","-0.12","-0.12","-0.12","-0.12","-0.12","-0.12","-0.12","-0.12","-0.12","-0.12","-0.13","-0.13","-0.13","-0.13","-0.13","-0.13","-0.14","-0.14","-0.14","-0.14","-0.14","-0.15","-0.15","-0.15","-0.15","-0.16","-0.16","-0.16","-0.16","-0.16","-0.16","-0.16","-0.17","-0.17","-0.17","-0.17","-0.17","-0.17","-0.18","-0.18","-0.18","-0.18","-0.18","-0.18","-0.18","-0.19","-0.19","-0.19","-0.19","-0.19","-0.19","-0.19","-0.19","-0.19","-0.20","-0.20","-0.20","-0.20","-0.20","-0.21","-0.21","-0.21","-0.21","-0.21","-0.21","-0.21","-0.22","-0.22","-0.22","-0.23","-0.23","-0.23","-0.23","-0.23","-0.23","-0.23","-0.23","-0.23","-0.23","-0.23","-0.24","-0.24","-0.24","-0.25","-0.25","-0.26","-0.26","-0.26","-0.26","-0.27","-0.28","-0.28","-0.28","-0.28","-0.28","-0.28","-0.28","-0.28","-0.29","-0.29","-0.29","-0.29","-0.29","-0.30","-0.30","-0.30","-0.30","-0.30","-0.30","-0.31","-0.31","-0.31","-0.32","-0.32","-0.32","-0.32","-0.32","-0.34","-0.34","-0.34","-0.34","-0.35","-0.35","-0.35","-0.35","-0.36","-0.36","-0.36","-0.36","-0.36","-0.36","-0.36","-0.37","-0.37","-0.37","-0.37","-0.38","-0.38","-0.39","-0.39","-0.39","-0.40","-0.41","-0.41","-0.41","-0.41","-0.42","-0.42","-0.42","-0.42","-0.44","-0.45","-0.45","-0.45","-0.46","-0.46","-0.48","-0.48","-0.49","-0.49","-0.51","-0.52","-0.52","-0.53","-0.53","-0.53","-0.54","-0.54","-0.56","-0.56","-0.58","-0.60","-0.61","-0.62","-0.62","-0.66","-0.69","-0.75","-0.80"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Attacking<\/th>\n      <th>Defense<\/th>\n      <th>Expected Offense<\/th>\n      <th>Expected Defense<\/th>\n      <th>Expected Margin<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-center","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gather-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="predict.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": true,
"weibo": false,
"instapper": false,
"vk": false,
"all": null
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/wjakethompson/soccer/edit/master/fit-model.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
